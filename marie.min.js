class MarieJS{constructor(s={}){this.config={parseTo:"hexadecimal",memorySize:4096,errorLogging:!1,debug:!1,logging:!0},this.logging=[],this.errors=[],Object.assign(this.config,s),this.memory=new Array(this.config.memorySize).fill(0),this.AC=0,this.MQ=0,this.PC=0,this.IR=0,this.MAR=0,this.MDR=0,this.parse=function(s){const i=this.config.parseTo.toLowerCase().substring(0,3);return"hex"==i?s.toString(16).toUpperCase():"dec"==i?s.toString(10):"bin"==i?s.toString(2):"oct"==i?s.toString(8):s.toString(16).toUpperCase()}}#s(s){if(this.config.errorLogging&&(s<0||s>=this.memory.length)||isNaN(s))return this.errors.push(`Error (Load): Address ${s} is out of bounds`),!1;this.MAR=s,this.MDR=this.memory[this.MAR],this.AC=this.MDR,this.config.logging&&this.logging.push(`Load: AC=${this.AC}`)}#i(s){if(this.config.errorLogging&&(s<0||s>=this.memory.length)||isNaN(s))return this.errors.push(`Error (Store): Address ${s} is out of bounds`),!1;this.MAR=s,this.memory[this.MAR]=this.AC,this.config.logging&&this.logging.push(`Store: Memory[${this.MAR}] = ${this.AC}`)}#r(s){if(this.config.errorLogging&&(s<0||s>=this.memory.length)||isNaN(s))return this.errors.push(`Error (Add): Address ${s} is out of bounds`),!1;this.MAR=s,this.MDR=this.memory[this.MAR],this.AC+=this.MDR,this.config.logging&&this.logging.push(`Add: AC = ${this.AC}`)}#t(s){if(this.config.errorLogging&&(s<0||s>=this.memory.length)||isNaN(s))return this.errors.push(`Error (Subtract): Address ${s} is out of bounds`),!1;this.MAR=s,this.MDR=this.memory[this.MAR],this.AC-=this.MDR,this.config.logging&&this.logging.push(`Subtract: AC = ${this.AC}`)}#o(){const s=prompt("Enter a number: ");if(this.AC=parseInt(s),this.config.errorLogging&&isNaN(this.AC))return this.errors.push(`Error (Input): Invalid input ${s}`),!1;this.config.logging&&this.logging.push(`Input: AC = ${this.AC}`)}#h(){if(this.config.errorLogging&&isNaN(this.AC))return this.errors.push(`Error (Output): Address ${this.AC} is out of bounds`),!1;this.config.logging&&this.logging.push(`Output: AC = ${this.parse(this.AC)}`)}#e(){return this.config.errorLogging&&(this.PC<0||this.PC>=this.memory.length)||isNaN(this.PC)?(this.errors.push(`Error (Fetch): Address ${this.PC} is out of bounds`),!1):(this.MAR=this.PC,this.IR=this.memory[this.MAR],this.IR)}#g(s){if(this.config.errorLogging&&(s<0||s>=this.memory.length)||isNaN(s))return this.errors.push(`Error (Exec): Instruction ${s} is out of bounds`),!1;const i=this.#n(s);return 1==i.opcode?this.#s(i.address):2==i.opcode?this.#i(i.address):3==i.opcode?this.#r(i.address):4==i.opcode?this.#t(i.address):5==i.opcode?this.#o():6==i.opcode?this.#h():void 0}#n(s){if(this.config.errorLogging&&(s<0||s>=this.memory.length)||isNaN(s))return void this.errors.push(`Error (Decode): Instruction ${s} is out of bounds`);return{opcode:s>>8,address:255&s}}#u(){this.PC+=1,this.config.debug}run(){for(;;){if(this.config.errorLogging&&(this.PC<0||this.PC>=this.memory.length)||isNaN(this.PC)){this.errors.push(`Error (Run): Address ${this.PC} is out of bounds`);break}const s=this.#e();if(!1===this.#g(s))break;if(this.#u(),3840==s){this.logging.push("Program halted");break}}}assemble(s){if(!Array.isArray(s))throw this.errors.push("Error (Assemble): Programs should be an array"),new Error("Programs should be an array");s.includes(3840)||s.push(3840);for(const i in s)this.memory[i]=s[i]}getMemory(){if(!(this.config.errorLogging&&(this.memory<0||this.memory>=this.memory.length)||isNaN(this.memory)))return this.memory;this.errors.push(`Error (Memory): Memory ${this.memory} is out of bounds`)}getRegisters(){return{AC:this.AC,MQ:this.MQ,PC:this.PC,IR:this.IR,MAR:this.MAR,MDR:this.MDR}}ins={LOAD:s=>256|255&s,STORE:s=>512|255&s,ADD:s=>768|255&s,SUBTRACT:s=>1024|255&s,INPUT:()=>1280,OUTPUT:()=>1536,HALT:()=>3840};getLogging(){return this.logging}getErrors(){return this.errors.map((s=>s.trim()))}}
